"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ "–ê—Ä—Å–∞–Ω".
"""
import os
import sys
import django
import codecs

if sys.platform == 'win32':
    sys.stdout = codecs.getwriter('utf-8')(sys.stdout.buffer, 'strict')
    sys.stderr = codecs.getwriter('utf-8')(sys.stderr.buffer, 'strict')

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'hikvision_project.settings')
django.setup()

from camera_events.models import Department

print("=" * 80)
print("–î–û–ë–ê–í–õ–ï–ù–ò–ï –ü–û–î–†–ê–ó–î–ï–õ–ï–ù–ò–ô –í –ë–ê–ó–£ –î–ê–ù–ù–´–•")
print("=" * 80)
print()

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π
departments_structure = {
    "–ê—Ä—Å–∞–Ω": {
        "IT –æ—Ç–¥–µ–ª": None,
        "–§—É–¥ —Å–µ—Ä–≤–∏—Å": {
            "–û—Ç–¥–µ–ª —Ä–∞–∑–≤–∏—Ç–∏—è": None,
        },
        "–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è": None,
        "Baton": None,
        "–ú–ö–ë": None,
        "–ñ–ö–ë": None,
        "–§–∏—Ç–Ω–µ—Å": {
            "–ö–∞—Å—Å–∏—Ä—ã": None,
            "–û—Ç–¥–µ–ª –ø—Ä–æ–¥–∞–∂": None,
            "–¢—Ä–µ–Ω–µ—Ä—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤": None,
            "–û—Ç–¥–µ–ª —Ä–∞–∑–≤–∏—Ç–∏—è": None,
        },
        "–û—Ç–¥–µ–ª –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞": None,
        "–û—Ç–¥–µ–ª –∑–∞–∫—É–ø–æ–∫": None,
        "–û—Ç–¥–µ–ª –ª–æ–≥–∏—Å—Ç–∏–∫–∏": None,
        "–û—Ç–¥–µ–ª –∫–∞–¥—Ä–æ–≤": None,
        "–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è": None,
        "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –æ—Ç–¥–µ–ª": None,
        "–û—Ç–¥–µ–ª –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏": None,
        "–û—Ç–¥–µ–ª –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∏–Ω–Ω–æ–≤–∞—Ü–∏—è–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ–º": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–æ–¥–∞–∂–∞–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–º": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∑–∞–∫—É–ø–∫–∞–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ª–æ–≥–∏—Å—Ç–∏–∫–æ–π": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∫–∞–¥—Ä–∞–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–µ–π": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é": None,
        "–û—Ç–¥–µ–ª –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∫–∞—á–µ—Å—Ç–≤–∞": None,
        "–¢–µ—Ö. –æ—Ç–¥–µ–ª": {
            "–í–æ–¥–∏—Ç–µ–ª–∏": None,
        },
        "–õ—é–∫—Å": None,
        "–û–ø–µ—Ä–∞—Ç–æ—Ä –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ": None,
        "–°–í–ö": None,
        "Welness Spa": {
            "–ú–µ–¥—Å–µ—Å—Ç—Ä–∞": None,
            "Call center": None,
            "–°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã –∏ –º–∞–≥–∞–∑–∏–Ω": None,
        },
    }
}

def create_departments(structure, parent=None):
    """
    –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å–æ–∑–¥–∞–µ—Ç –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
    
    Args:
        structure: –°–ª–æ–≤–∞—Ä—å —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –∏ –∏—Ö –¥–æ—á–µ—Ä–Ω–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
        parent: –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (Department –æ–±—ä–µ–∫—Ç –∏–ª–∏ None)
    """
    created_count = 0
    updated_count = 0
    
    for name, children in structure.items():
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
        dept, created = Department.objects.get_or_create(
            name=name,
            parent=parent,
            defaults={'name': name, 'parent': parent}
        )
        
        if created:
            created_count += 1
            print(f"‚úÖ –°–æ–∑–¥–∞–Ω–æ: {dept.get_full_path()}")
        else:
            updated_count += 1
            print(f"‚ÑπÔ∏è  –£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {dept.get_full_path()}")
        
        # –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å–æ–∑–¥–∞–µ–º –¥–æ—á–µ—Ä–Ω–∏–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
        if children:
            child_created, child_updated = create_departments(children, parent=dept)
            created_count += child_created
            updated_count += child_updated
    
    return created_count, updated_count

# –°–æ–∑–¥–∞–µ–º –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
print("–ù–∞—á–∏–Ω–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π...")
print()

created, updated = create_departments(departments_structure)

print()
print("=" * 80)
print("–†–ï–ó–£–õ–¨–¢–ê–¢–´")
print("=" * 80)
print(f"‚úÖ –°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π: {created}")
print(f"‚ÑπÔ∏è  –£–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π: {updated}")
print(f"üìä –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {created + updated}")
print()

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
print("=" * 80)
print("–ò–¢–û–ì–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–û–î–†–ê–ó–î–ï–õ–ï–ù–ò–ô")
print("=" * 80)
print()

def print_department_tree(departments, indent=0):
    """–†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–≤–æ–¥–∏—Ç –¥–µ—Ä–µ–≤–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π."""
    for dept in departments:
        prefix = "  " * indent + ("‚îî‚îÄ " if indent > 0 else "")
        print(f"{prefix}{dept.name} (ID: {dept.id})")
        children = dept.children.all().order_by('name')
        if children.exists():
            print_department_tree(children, indent + 1)

root_departments = Department.objects.filter(parent=None).order_by('name')
if root_departments.exists():
    print_department_tree(root_departments)
else:
    print("‚ùå –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!")

print()
print("=" * 80)
print("–ì–û–¢–û–í–û!")
print("=" * 80)

